language: python

jobs:
  include:
    - name: "Windows x86"
      os: windows
      language: shell
      env:
        - CIBW_BUILD="cp27-win32 cp38-win32"
        - xCIBW_BUILD="cp27-win32 cp36-win32 cp37-win32 cp38-win32 cp39-win32"
        - CIBW_BEFORE_BUILD="pip install delvewheel"
        - CIBW_TEST_COMMAND="python {project}/sample.py"
        - CIBW_BUILD_VERBOSITY=3
        - INCLUDE_DIRS="c:\\inst\\build\\native\\include"
        - DLL_DIR="c:\\inst\\runtimes\\win-x86\\native"
        - LIB_DIRS="c:\\inst\\build\\native\\lib\\win\\x86\\win-x86-Release\\v120"
        - CIBW_REPAIR_WHEEL_COMMAND="delvewheel repair --add-path c:\\inst\\runtimes\\win-x86\\native -w {dest_dir} {wheel}"
      before_install:
        - choco install python --version 3.8.0
        - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
        # make sure it's on PATH as 'python3'
        - ln -s /c/Python38/python.exe /c/Python38/python3.exe
      install:
        - bash install-librdkafka.sh /c/inst/
        - python3 -m pip install cibuildwheel==1.7.4
        - set

#    # perform a linux build
#    - services: docker
#    # and a mac build
#    - os: osx
#      language: shell

script:
  # build the wheels, put them into './wheelhouse'
  - python3 -m cibuildwheel --output-dir wheelhouse
  - dir wheelhouse
  - for f in wheelhouse/*whl ; do echo $f ; unzip -l $f ; done
  - echo Done
